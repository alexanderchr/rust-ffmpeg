VPATH=%VPATH%

RUSTC ?= rustc

RUST_SRC=$(shell find $(VPATH)/. -type f -name 'src/*.rs')

RUSTFLAGS = #--cfg debug
FFMPEG_LIB = $(VPATH)/ffmpeg/lib

.PHONY: all
all: avutil.dummy avcodec.dummy avfilter.dummy avformat.dummy avdevice.dummy \
     swresample.dummy swscale.dummy

avutil.dummy: $(VPATH)/src/avutil.rs
	$(RUSTC) $(RUSTFLAGS) --lib -L . -L ${FFMPEG_LIB} $< -o $@
	touch $@

avcodec.dummy: $(VPATH)/src/avcodec.rs avutil.dummy
	$(RUSTC) $(RUSTFLAGS) --lib -L . -L ${FFMPEG_LIB} $< -o $@
	touch $@

avformat.dummy: $(VPATH)/src/avformat.rs avcodec.dummy
	$(RUSTC) $(RUSTFLAGS) --lib -L . -L ${FFMPEG_LIB} $< -o $@
	touch $@

avfilter.dummy: $(VPATH)/src/avfilter.rs
	$(RUSTC) $(RUSTFLAGS) --lib -L . -L ${FFMPEG_LIB} $< -o $@
	touch $@

avdevice.dummy: $(VPATH)/src/avdevice.rs
	$(RUSTC) $(RUSTFLAGS) --lib -L . -L ${FFMPEG_LIB} $< -o $@
	touch $@

swresample.dummy: $(VPATH)/src/swresample.rs
	$(RUSTC) $(RUSTFLAGS) --lib -L . -L ${FFMPEG_LIB} $< -o $@
	touch $@

swscale.dummy: $(VPATH)/src/swscale.rs
	$(RUSTC) $(RUSTFLAGS) --lib -L . -L ${FFMPEG_LIB} $< -o $@
	touch $@

.PHONY: clean
clean:
	rm -f *.so *.dummy
